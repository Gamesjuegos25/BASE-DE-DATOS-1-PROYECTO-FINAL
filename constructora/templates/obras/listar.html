{% extends "base.html" %}

{% block title %}Lista de Obras - Sistema Constructora{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <div>
            <h1>Lista de Obras</h1>
            <p>Gestión y administración de todas las obras</p>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('crear_obra') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Nueva Obra
            </a>
        </div>
    </div>
</div>

<!-- Filtros de búsqueda -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">Filtros de Búsqueda</h3>
    </div>
    
    <form method="GET" class="search-form">
        <div class="form-row">
            <div class="form-group">
                <label for="search" class="form-label">Buscar por nombre</label>
                <input type="text" id="search" name="search" class="form-control" 
                       value="{{ request.args.get('search', '') }}" 
                       placeholder="Nombre de la obra...">
            </div>
            
            <div class="form-group">
                <label for="estado" class="form-label">Estado</label>
                <select id="estado" name="estado" class="form-control">
                    <option value="">Todos los estados</option>
                    <option value="Planeación" {{ 'selected' if request.args.get('estado') == 'Planeación' }}>Planeación</option>
                    <option value="En Progreso" {{ 'selected' if request.args.get('estado') == 'En Progreso' }}>En Progreso</option>
                    <option value="Pausado" {{ 'selected' if request.args.get('estado') == 'Pausado' }}>Pausado</option>
                    <option value="Completado" {{ 'selected' if request.args.get('estado') == 'Completado' }}>Completado</option>
                    <option value="Cancelado" {{ 'selected' if request.args.get('estado') == 'Cancelado' }}>Cancelado</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">&nbsp;</label>
                <div class="filter-buttons">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                        Buscar
                    </button>
                    <a href="{{ url_for('listar_obras') }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i>
                        Limpiar
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Tabla de obras -->
{% if obras %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            Obras Encontradas 
            <span class="badge">{{ obras|length }}</span>
        </h3>
    </div>
    
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Cliente</th>
                    <th>Estado</th>
                    <th>Fecha Inicio</th>
                    <th>Fecha Fin</th>
                    <th>Valor</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for obra in obras %}
                <tr>
                    <td>
                        <div class="obra-name">{{ obra.nombre }}</div>
                        {% if obra.descripcion %}
                        <div class="obra-desc">{{ obra.descripcion[:60] }}{% if obra.descripcion|length > 60 %}...{% endif %}</div>
                        {% endif %}
                    </td>
                    <td>{{ obra.cliente or 'No asignado' }}</td>
                    <td>
                        <span class="status-badge status-{{ obra.estado.lower().replace(' ', '-') if obra.estado else 'unknown' }}">
                            {{ obra.estado or 'Sin estado' }}
                        </span>
                    </td>
                    <td>{{ obra.fecha_inicio.strftime('%d/%m/%Y') if obra.fecha_inicio else 'No definida' }}</td>
                    <td>{{ obra.fecha_fin.strftime('%d/%m/%Y') if obra.fecha_fin else 'No definida' }}</td>
                    <td class="valor">${{ "{:,.0f}".format(obra.valor) if obra.valor else '0' }}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" title="Eliminar" 
                                    onclick="return confirm('¿Está seguro de eliminar esta obra?')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fas fa-building"></i>
        </div>
        <h3>No se encontraron obras</h3>
        <p>No hay obras que coincidan con los criterios de búsqueda.</p>
        <a href="{{ url_for('crear_obra') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Crear Nueva Obra
        </a>
    </div>
</div>
{% endif %}

<style>
.page-header {
    margin-bottom: 30px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.page-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 8px;
}

.page-header p {
    color: #6c757d;
    font-size: 16px;
}

.search-form {
    padding: 20px;
}

.filter-buttons {
    display: flex;
    gap: 10px;
}

.badge {
    background-color: #6c757d;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.obra-name {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 4px;
}

.obra-desc {
    font-size: 12px;
    color: #6c757d;
    font-style: italic;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.status-planeación {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.status-en-progreso {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.status-pausado {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-completado {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-cancelado {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-unknown {
    background-color: #e9ecef;
    color: #6c757d;
    border: 1px solid #ced4da;
}

.valor {
    font-family: monospace;
    font-weight: 600;
    color: #28a745;
}

.action-buttons {
    display: flex;
    gap: 5px;
}

.btn-sm {
    padding: 6px 10px;
    font-size: 12px;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-icon {
    font-size: 64px;
    color: #e9ecef;
    margin-bottom: 20px;
}

.empty-state h3 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.empty-state p {
    color: #6c757d;
    margin-bottom: 30px;
}

@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    
    .filter-buttons {
        flex-direction: column;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    .action-buttons {
        flex-direction: column;
    }
}
</style>
{% endblock %}