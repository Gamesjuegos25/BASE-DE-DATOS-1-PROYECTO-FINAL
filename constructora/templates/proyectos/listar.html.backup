{% extends "base.html" %}

{% block title %}Gestión de Proyectos - Sistema ERP{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <div class="header-left">
            <h1 class="page-title">
                <i class="fas fa-project-diagram"></i>
                Gestión de Proyectos
            </h1>
            <p class="page-subtitle">Control y seguimiento de proyectos de construcción</p>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('crear_proyecto') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Nuevo Proyecto
            </a>
        </div>
    </div>
</div>

<!-- Estadísticas de Proyectos -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon bg-blue">
            <i class="fas fa-project-diagram"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number">{{ proyectos|length }}</div>
            <div class="stat-label">Total Proyectos</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon bg-green">
            <i class="fas fa-play-circle"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number">{{ proyectos|selectattr('estado', 'equalto', 'En Progreso')|list|length }}</div>
            <div class="stat-label">En Progreso</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon bg-orange">
            <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number">{{ proyectos|selectattr('estado', 'equalto', 'Planificación')|list|length }}</div>
            <div class="stat-label">En Planificación</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon bg-purple">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number">{{ proyectos|selectattr('estado', 'equalto', 'Completado')|list|length }}</div>
            <div class="stat-label">Completados</div>
        </div>
    </div>
</div>

<!-- Lista de Proyectos -->
<div class="data-table-container">
    <div class="table-header">
        <div class="table-title">
            <h3>Lista de Proyectos</h3>
            <span class="record-count">{{ proyectos|length }} registros</span>
        </div>
    </div>
    
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Proyecto</th>
                    <th>Fecha Inicio</th>
                    <th>Fecha Fin</th>
                    <th>Presupuesto</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for proyecto in proyectos %}
                <tr>
                    <td>{{ proyecto.id or proyecto.proyecto_id or 'N/A' }}</td>
                    <td>
                        <div class="project-info">
                            <strong>{{ proyecto.nombre or 'Sin nombre' }}</strong>
                            {% if proyecto.descripcion %}
                            <div class="project-desc">{{ proyecto.descripcion[:50] }}...</div>
                            {% endif %}
                        </div>
                    </td>
                    <td>{{ proyecto.fecha_inicio or 'No definida' }}</td>
                    <td>{{ proyecto.fecha_fin or 'No definida' }}</td>
                    <td>
                        {% if proyecto.presupuesto %}
                            <span class="budget-amount">Q{{ "{:,.2f}".format(proyecto.presupuesto) }}</span>
                        {% else %}
                            <span class="text-muted">No definido</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge status-info">
                            <i class="fas fa-circle"></i>
                            {{ proyecto.estado or 'Planificación' }}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <div class="table-actions">
                            <a class="btn-action btn-view" 
                               title="Ver detalles"
                               href="{{ url_for('ver_proyecto', id=(proyecto.id or proyecto.proyecto_id)) }}">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a class="btn-action btn-edit" 
                               title="Editar"
                               href="{{ url_for('editar_proyecto', id=(proyecto.id or proyecto.proyecto_id)) }}">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form action="{{ url_for('eliminar_proyecto', id=(proyecto.id or proyecto.proyecto_id)) }}" 
                                  method="post" 
                                  onsubmit="return confirm('¿Eliminar este proyecto?');">
                                <button class="btn-action btn-danger" title="Eliminar" type="submit">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="empty-state">
                        <div class="empty-content">
                            <i class="fas fa-project-diagram"></i>
                            <h3>No hay proyectos registrados</h3>
                            <p>Comienza agregando el primer proyecto de construcción</p>
                            <a href="{{ url_for('crear_proyecto') }}" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Agregar Primer Proyecto
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}